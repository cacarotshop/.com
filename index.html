<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Ø´Ø­Ù† ÙØ±ÙŠ ÙØ§ÙŠØ± - 
CACAROT SHOP</title>
<style>
* {
    margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    color: #fff;
    min-height: 100vh;
    padding: 15px 20px;
    overflow-x: hidden;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(255,107,53,0.3);
    backdrop-filter: blur(10px);
}
.header {
    text-align: center;
    padding: 30px 15px;
    margin-bottom: 30px;
}
.header h1 {
    font-size: clamp(1.5em, 5vw, 2.5em);
    color: #ff6b35;
    text-shadow: 0 0 20px rgba(255,107,53,0.5);
    margin-bottom: 10px;
}
.header p {
    color: #ddd;
    font-size: clamp(0.9em, 3vw, 1.1em);
}
.section {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 15px;
    border: 1px solid rgba(255,255,255,0.15);
    margin-bottom: 20px;
}
.section h2 {
    color: #ff6b35;
    margin-bottom: 20px;
    font-size: clamp(1.2em, 4vw, 1.5em);
    border-bottom: 2px solid #ff6b35;
    padding-bottom: 10px;
}
.input-group {
    margin-bottom: 15px;
}
.input-group label {
    display: block;
    margin-bottom: 8px;
    color: #ddd;
    font-weight: 500;
    font-size: clamp(0.9em, 3vw, 1em);
}
.input-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.1);
    color: #fff;
    border-radius: 8px;
    font-size: clamp(0.9em, 3vw, 1em);
    outline: none;
    transition: border-color 0.3s;
}
.input-group input:focus {
    border-color: #ff6b35;
    background: rgba(255,255,255,0.15);
}
.packages-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
    gap: 15px;
}
.package-card {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    border: 2px solid transparent;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}
.package-card.selected,
.package-card:hover {
    border-color: #ff6b35;
    background: rgba(255,107,53,0.2);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255,107,53,0.3);
}
.package-card .diamonds {
    font-weight: bold;
    color: #ffd700;
    font-size: clamp(1.3em, 4vw, 1.8em);
    margin-bottom: 8px;
}
.package-card .price {
    font-weight: bold;
    color: #4ecca3;
    font-size: clamp(1em,3.5vw,1.3em);
}
.package-name {
    font-weight: bold;
    color: #ffd700;
    font-size: clamp(1em, 3vw, 1.2em);
    margin-bottom: 8px;
}
.payment-methods {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 20px;
}
.payment-method {
    display: flex;
    align-items: center;
    gap: 8px;
    border: 2px solid transparent;
    border-radius: 10px;
    padding: 10px 15px;
    cursor: pointer;
    transition: all 0.3s;
    user-select: none;
}
.payment-method.selected,
.payment-method:hover {
    border-color: #ff6b35;
    background: rgba(255,107,53,0.2);
}
.payment-method img {
    width: 24px;
    height: 24px;
}
.btn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-size: clamp(0.95em,3vw,1.1em);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}
.btn-primary {
    background: linear-gradient(135deg, #ff6b35, #f7931e);
    color: #fff;
}
.btn-primary:hover:not(:disabled) {
    box-shadow: 0 10px 30px rgba(255,107,53,0.4);
}
.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.payment-info {
    background: rgba(255,255,255,0.08);
    padding: 18px;
    border-radius: 10px;
    border: 2px solid #4ecca3;
    margin-bottom: 15px;
}
.payment-detail {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    padding: 10px 0;
    font-size: clamp(0.85em, 3vw, 1em);
}
.payment-detail:last-child {
    border-bottom: none;
    font-weight: bold;
}
.upload-area {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    color: #ddd;
}
.upload-area:focus {
    outline: 2px solid #ff6b35;
}
.upload-icon {
    font-size: 2.5em;
    margin-bottom: 8px;
}
.file-preview {
    max-width: 100%;
    max-height: 180px;
    border-radius: 10px;
    margin-top: 10px;
    display: none;
}
.file-preview.active {
    display: block;
}
.file-name, .file-size {
    font-size: 0.8em;
    margin-top: 5px;
}
.remove-file {
    display: none;
    margin-top: 10px;
    background: #ff6b35;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
}
.loading-spinner {
    display: none;
    border: 4px solid rgba(255,255,255,0.2);
    border-top: 4px solid #ff6b35;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    margin: 15px auto;
    animation: spin 1s linear infinite;
}
.loading-spinner.active {
    display: block;
}
@keyframes spin {
    0% {transform: rotate(0deg);}
    100% {transform: rotate(360deg);}
}
.modal {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
.modal.active {
    display: flex;
}
.modal-content {
    background: #1a1a2e;
    border-radius: 15px;
    padding: 30px 40px;
    width: 90%;
    max-width: 450px;
    color: #fff;
    position: relative;
}
.receipt h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #ff6b35;
}
.receipt-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    font-size: 1em;
}
.print-btn, .close-btn {
    margin-top: 15px;
    width: 48%;
    font-weight: bold;
    padding: 10px 0;
    border: none;
    border-radius: 7px;
    cursor: pointer;
}
.print-btn {
    background: #4ecca3;
    color: #000;
}
.print-btn:hover {
    box-shadow: 0 6px 20px rgba(78,204,163,0.5);
}
.close-btn {
    background: #ff6b35;
    color: #fff;
}
.close-btn:hover {
    box-shadow: 0 6px 20px rgba(255,107,53,0.5);
}
.alert {
    padding: 12px;
    border-radius: 8px;
    margin-top: 15px;
    font-weight: bold;
    text-align: center;
    font-size: 1em;
}
.alert-success {
    background: #4ecca3;
    color: #000;
}
.alert-error {
    background: #ff6b35;
    color: #fff;
}
</style>
</head>
<body>

<div class="container" id="page1">
    <div class="header">
        <h1>ğŸ”¥ Ø´Ø­Ù† ÙØ±ÙŠ ÙØ§ÙŠØ± - 
        CACAROT SHOP</h1>
        <p>Ø£Ø¯Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</p>
    </div>

    <div class="section">
        <h2>1ï¸âƒ£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
        <div class="input-group">
            <label for="playerId">Ù…Ø¹Ø±Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ (Player ID)</label>
            <input type="tel" id="playerId" placeholder="Ø£Ø¯Ø®Ù„ Player ID (8-12 Ø±Ù‚Ù…)" maxlength="12" inputmode="numeric" />
        </div>
        <div class="input-group">
            <label for="senderPhone">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</label>
            <input type="tel" id="senderPhone" placeholder="01xxxxxxxxx" maxlength="11" inputmode="numeric" />
        </div>
    </div>

    <div class="section">
        <h2>2ï¸âƒ£ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</h2>
        <div class="packages-grid" id="packagesGrid"></div>
    </div>

    <div class="section">
        <h2>3ï¸âƒ£ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h2>
        <div class="payment-methods" id="paymentMethods">
            <div class="payment-method" data-method="Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Etisalat_logo.svg/32px-Etisalat_logo.svg.png" alt="Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´" />
                Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´
            </div>
            <div class="payment-method" data-method="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Vodafone_logo.svg/32px-Vodafone_logo.svg.png" alt="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´" />
                ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´
            </div>
            <div class="payment-method" data-method="We Pay" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± We Pay">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/WE_Logo.svg/32px-WE_Logo.svg.png" alt="We Pay" />
                We Pay
            </div>
            <div class="payment-method" data-method="Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Orange_Logo.svg/32px-Orange_Logo.svg.png" alt="Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´" />
                Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´
            </div>
        </div>
    </div>

    <button class="btn btn-primary" id="buyBtn" disabled>Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</button>
</div>

<div class="container" id="page2" style="display:none;">
    <div class="header">
        <h1>ğŸ”¥ Ø´Ø­Ù† ÙØ±ÙŠ ÙØ§ÙŠØ± - 
        Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¯ÙØ¹ Ù…Ø¹ CACAROT SHOP</h1>
        <p>Ù‚Ù… Ø¨Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØ£ÙƒØ¯ Ø·Ù„Ø¨Ùƒ</p>
    </div>

    <div class="section">
        <h2>4ï¸âƒ£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h2>
        <div class="input-group">
            <label for="senderTransferNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡</label>
            <input type="tel" id="senderTransferNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡" maxlength="11" inputmode="numeric" />
        </div>
    </div>

    <div class="section">
        <h2>5ï¸âƒ£ Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h2>
        <div class="payment-info">
            <h3>ğŸ’³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
            <div class="payment-detail">
                <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span>
                <div>
                    <strong id="walletNumber">01123216926</strong>
                    <button class="copy-btn" id="copyWalletBtn">Ù†Ø³Ø®</button>
                </div>
            </div>
            <div class="payment-detail">
                <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
                <strong id="totalAmount2">0 Ø¬Ù†ÙŠÙ‡</strong>
            </div>
            <div class="payment-detail" style="color: #4ecca3;">
                <span>ğŸ’ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± / Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</span>
                <strong id="selectedDiamonds2">0</strong>
            </div>
        </div>

        <div class="upload-area" id="uploadArea" tabindex="0" role="button" aria-label="Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹">
            <div class="upload-icon">ğŸ“¸</div>
            <div class="upload-text">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹<br><small>(JPG/PNG Ø­ØªÙ‰ 5MB)</small></div>
            <img id="imagePreview" class="file-preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹">
            <div id="fileName" class="file-name"></div>
            <div id="fileSize" class="file-size"></div>
            <button id="removeFileBtn" class="remove-file">Ø¥Ø²Ø§Ù„Ø©</button>
        </div>
        <input type="file" id="paymentProof" accept="image/jpeg,image/jpg,image/png" style="display:none;" />

        <div class="loading-spinner" id="loadingSpinner"></div>

        <button class="btn" id="backToPage1Btn">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</button>
        <button class="btn btn-primary" id="confirmBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
        <div id="message" class="alert" style="display:none;"></div>
    </div>
</div>

<div class="modal" id="receiptModal" role="dialog" aria-modal="true" aria-labelledby="receiptTitle">
    <div class="modal-content">
        <div class="receipt" id="receipt">
            <h2 id="receiptTitle">ğŸ“‹ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹</h2>
            <div class="receipt-row"><span>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span> <strong id="orderNumber"></strong></div>
            <div class="receipt-row"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <strong id="orderDate"></strong></div>
            <div class="receipt-row"><span>Player ID:</span> <strong id="receiptPlayerId"></strong></div>
            <div class="receipt-row"><span>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</span> <strong id="receiptSenderPhone"></strong></div>
            <div class="receipt-row"><span>Ø§Ù„Ø¨Ø§Ù‚Ø© / Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</span> <strong id="receiptPackage"></strong></div>
            <div class="receipt-row"><span>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span> <strong id="receiptPaymentMethod"></strong></div>
            <div class="receipt-row"><span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span> <strong>01123216926</strong></div>
            <div class="receipt-row"><span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡:</span> <strong id="receiptSenderTransferNumber">-</strong></div>
            <div class="receipt-row"><span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span> <strong id="receiptAmount"></strong></div>
            <div class="receipt-row"><span>Ø±Ø§Ø¨Ø· Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹:</span> 
                <a href="#" id="receiptPaymentProofLink" target="_blank" rel="noopener noreferrer" style="color:#4ecca3;">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©</a>
            </div>
        </div>
        <button class="print-btn" id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="close-btn" id="closeModalBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
const packages = [
    {type: 'diamonds', diamonds: 100, basePrice: 55},
    {type: 'diamonds', diamonds: 210, basePrice: 110},
    {type: 'diamonds', diamonds: 310, basePrice: 165},
    {type: 'diamonds', diamonds: 520, basePrice: 250},
    {type: 'diamonds', diamonds: 1060, basePrice: 550},
    {type: 'diamonds', diamonds: 2180, basePrice: 1100},
    {type: 'diamonds', diamonds: 5600, basePrice: 2800},
    {type: 'membership', name: 'Weekly Membership', basePrice: 120},
    {type: 'membership', name: 'Monthly Membership', basePrice: 550}
];

let selectedPackage = null;
let selectedPaymentMethod = null;
let paymentProofFile = null;
let paymentProofDataUrl = '';

const packagesGrid = document.getElementById('packagesGrid');
const playerIdInput = document.getElementById('playerId');
const senderPhoneInput = document.getElementById('senderPhone');
const senderTransferNumberInput = document.getElementById('senderTransferNumber');
const paymentMethodsDiv = document.getElementById('paymentMethods');
const buyBtn = document.getElementById('buyBtn');

const page1 = document.getElementById('page1');
const page2 = document.getElementById('page2');

const walletNumberElem = document.getElementById('walletNumber');
const selectedDiamondsElem2 = document.getElementById('selectedDiamonds2');
const totalAmountElem2 = document.getElementById('totalAmount2');

const uploadArea = document.getElementById('uploadArea');
const paymentProofInput = document.getElementById('paymentProof');
const imagePreview = document.getElementById('imagePreview');
const fileNameElem = document.getElementById('fileName');
const fileSizeElem = document.getElementById('fileSize');
const removeFileBtn = document.getElementById('removeFileBtn');
const loadingSpinner = document.getElementById('loadingSpinner');
const confirmBtn = document.getElementById('confirmBtn');
const messageDiv = document.getElementById('message');

const receiptModal = document.getElementById('receiptModal');
const closeModalBtn = document.getElementById('closeModalBtn');
const printBtn = document.getElementById('printBtn');
const orderNumberElem = document.getElementById('orderNumber');
const orderDateElem = document.getElementById('orderDate');
const receiptPlayerId = document.getElementById('receiptPlayerId');
const receiptSenderPhone = document.getElementById('receiptSenderPhone');
const receiptSenderTransferNumber = document.getElementById('receiptSenderTransferNumber');
const receiptPackage = document.getElementById('receiptPackage');
const receiptPaymentMethod = document.getElementById('receiptPaymentMethod');
const receiptAmount = document.getElementById('receiptAmount');
const receiptPaymentProofLink = document.getElementById('receiptPaymentProofLink');

const telegramBotToken = '8461231598:AAEaqlQG7mm2xVE2jZRbScW_tBTrGdL1MvU';
const telegramChatId = '5778306576';

function initPackages() {
    packagesGrid.innerHTML = packages.map((pkg, index) => {
        if (pkg.type === 'diamonds') {
            return `
            <div class="package-card" onclick="selectPackage(${index})" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø§Ù‚Ø© ${pkg.diamonds} Ø¬ÙˆÙ‡Ø±Ø© Ø¨Ø³Ø¹Ø± ${pkg.basePrice} Ø¬Ù†ÙŠÙ‡">
                <div class="diamonds">ğŸ’ ${pkg.diamonds}</div>
                <div class="price">${pkg.basePrice} Ø¬Ù†ÙŠÙ‡</div>
            </div>`;
        } else if (pkg.type === 'membership') {
            return `
            <div class="package-card" onclick="selectPackage(${index})" tabindex="0" role="button" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ${pkg.name} Ø¨Ø³Ø¹Ø± ${pkg.basePrice} Ø¬Ù†ÙŠÙ‡">
                <div class="package-name">${pkg.name}</div>
                <div class="price">${pkg.basePrice} Ø¬Ù†ÙŠÙ‡</div>
            </div>`;
        }
    }).join('');
}
initPackages();

function selectPackage(index) {
    selectedPackage = packages[index];
    document.querySelectorAll('.package-card').forEach((card,i) => {
        card.classList.toggle('selected', i === index);
    });

    if (selectedPackage.type === 'diamonds') {
        totalAmountElem2.textContent = `${selectedPackage.basePrice} Ø¬Ù†ÙŠÙ‡`;
        selectedDiamondsElem2.textContent = `${selectedPackage.diamonds} Ø¬ÙˆÙ‡Ø±Ø©`;
    } else if (selectedPackage.type === 'membership') {
        totalAmountElem2.textContent = `${selectedPackage.basePrice} Ø¬Ù†ÙŠÙ‡`;
        selectedDiamondsElem2.textContent = selectedPackage.name;
    }
    buyBtn.disabled = false;
}

paymentMethodsDiv.addEventListener('click', e => {
    const methodDiv = e.target.closest('.payment-method');
    if (!methodDiv) return;
    selectedPaymentMethod = methodDiv.getAttribute('data-method');
    document.querySelectorAll('.payment-method').forEach(pm =>
        pm.classList.toggle('selected', pm === methodDiv)
    );
});
paymentMethodsDiv.addEventListener('keydown', e => {
    if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('payment-method')) {
        e.preventDefault();
        e.target.click();
    }
});

buyBtn.addEventListener('click', () => {
    if (!selectedPackage) return;
    if(!selectedPaymentMethod){
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }
    page1.style.display = 'none';
    page2.style.display = 'block';
    messageDiv.style.display = 'none';
    clearFileUpload();
    senderTransferNumberInput.value = '';
});

function validateFile(file) {
    if (!file) return false;
    const validTypes = ['image/jpeg','image/png','image/jpg'];
    if (!validTypes.includes(file.type)) return false;
    if (file.size > 5 * 1024 * 1024) return false;
    return true;
}
function handleFileSelect(e) {
    const file = e.target.files[0];
    if (!file) return;
    if (!validateFile(file)) {
        showMessage('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø§Ù„Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù…Ù† 5MB', 'error');
        return;
    }
    paymentProofFile = file;
    const reader = new FileReader();
    reader.onload = function(ev) {
        imagePreview.src = ev.target.result;
        imagePreview.classList.add('active');
        paymentProofDataUrl = ev.target.result;
    }
    reader.readAsDataURL(file);
    fileNameElem.textContent = file.name;
    fileSizeElem.textContent = (file.size / 1024).toFixed(2) + ' KB';
    removeFileBtn.style.display = 'inline-block';
    uploadArea.classList.add('has-file');
    showMessage('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
}

function clearFileUpload() {
    paymentProofFile = null;
    paymentProofInput.value = '';
    imagePreview.src = '';
    imagePreview.classList.remove('active');
    fileNameElem.textContent = '';
    fileSizeElem.textContent = '';
    removeFileBtn.style.display = 'none';
    uploadArea.classList.remove('has-file');
    paymentProofDataUrl = '';
}

removeFileBtn.addEventListener('click', e => {
    e.stopPropagation();
    clearFileUpload();
});

uploadArea.addEventListener('click', () => paymentProofInput.click());
paymentProofInput.addEventListener('change', handleFileSelect);

document.getElementById('copyWalletBtn').addEventListener('click', () => {
    const walletNum = walletNumberElem.textContent;
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(walletNum).then(() => {
            alert('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        }).catch(() => {
            alert('Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©: ' + walletNum);
        });
    } else {
        alert('Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©: ' + walletNum);
    }
});

function showMessage(msg, type) {
    messageDiv.textContent = msg;
    messageDiv.className = 'alert ' + (type === 'success' ? 'alert-success' : 'alert-error');
    messageDiv.style.display = 'block';
    setTimeout(() => {messageDiv.style.display = 'none';}, 4000);
}

// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ© - Ù‡Ø°Ù‡ Ù…Ù…ÙƒÙ† Ø¥Ø¨Ù‚Ø§Ø¤Ù‡Ø§ Ø§Ùˆ Ø­Ø°ÙÙ‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
async function sendTelegramMessage(text) {
    const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
    const params = {
        chat_id: telegramChatId,
        text: text,
        parse_mode: 'HTML'
    };
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(params)
        });
        const data = await response.json();
        if(!data.ok) throw new Error(data.description);
        return true;
    } catch (error) {
        console.error('Telegram API error:', error);
        return false;
    }
}

// Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù…Ø¹ ØªØ¹Ù„ÙŠÙ‚ (caption) ÙŠØªØ¶Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
async function sendTelegramPhoto(file, caption) {
    const formData = new FormData();
    formData.append('chat_id', telegramChatId);
    formData.append('photo', file);
    if (caption) formData.append('caption', caption);

    try {
        const response = await fetch(`https://api.telegram.org/bot${telegramBotToken}/sendPhoto`, {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        if (!data.ok) throw new Error(data.description);
        return true;
    } catch (error) {
        console.error('Telegram sendPhoto API error:', error);
        return false;
    }
}

confirmBtn.addEventListener('click', async () => {
    if (!paymentProofFile) {
        showMessage('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return;
    }
    confirmBtn.disabled = true;
    loadingSpinner.classList.add('active');

    const playerId = playerIdInput.value.trim() || 'ØºÙŠØ± Ù…ÙØ¯Ø®Ù„';
    const senderPhone = senderPhoneInput.value.trim() || 'ØºÙŠØ± Ù…ÙØ¯Ø®Ù„';
    const senderTransferNumber = senderTransferNumberInput.value.trim() || 'ØºÙŠØ± Ù…ÙØ¯Ø®Ù„';
    const packageInfo = selectedPackage || {diamonds: 0, basePrice: 0};
    const amount = packageInfo.basePrice || 0;
    const paymentMethod = selectedPaymentMethod || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

    const orderNumber = Math.floor(Math.random() * 9000000) + 1000000;
    const orderDate = new Date().toLocaleString('ar-EG',{timeZone:'Africa/Cairo'});

    orderNumberElem.textContent = orderNumber;
    orderDateElem.textContent = orderDate;
    receiptPlayerId.textContent = playerId;
    receiptSenderPhone.textContent = senderPhone;
    receiptSenderTransferNumber.textContent = senderTransferNumber;
    if(packageInfo.type === 'diamonds'){
        receiptPackage.textContent = `${packageInfo.diamonds} Ø¬ÙˆÙ‡Ø±Ø©`;
    } else {
        receiptPackage.textContent = packageInfo.name;
    }
    receiptPaymentMethod.textContent = paymentMethod;
    receiptAmount.textContent = amount + ' Ø¬Ù†ÙŠÙ‡';
    receiptPaymentProofLink.href = paymentProofDataUrl;

    const caption = `
ğŸ”¥ Ø·Ù„Ø¨ Ø´Ø­Ù† ÙØ±ÙŠ ÙØ§ÙŠØ± Ø¬Ø¯ÙŠØ¯ ğŸ”¥
Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderNumber}
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${orderDate}
Player ID: ${playerId}
Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: ${senderPhone}
Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡: ${senderTransferNumber}
Ø§Ù„Ø¨Ø§Ù‚Ø© / Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: ${packageInfo.type === 'diamonds' ? packageInfo.diamonds + ' Ø¬ÙˆÙ‡Ø±Ø©' : packageInfo.name}
Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentMethod}
Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${amount} Ø¬Ù†ÙŠÙ‡
`;

    setTimeout(async () => {
        const sent = await sendTelegramPhoto(paymentProofFile, caption);
        loadingSpinner.classList.remove('active');
        confirmBtn.disabled = false;
        if (sent) {
            receiptModal.classList.add('active');
            showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ÙˆØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
        } else {
            showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…', 'error');
        }
    }, 1500);
});

closeModalBtn.addEventListener('click', () => receiptModal.classList.remove('active'));
printBtn.addEventListener('click', () => window.print());

const backToPage1Btn = document.getElementById('backToPage1Btn');
backToPage1Btn.addEventListener('click', () => {
    page2.style.display = 'none';
    page1.style.display = 'block';
    messageDiv.style.display = 'none';
    clearFileUpload();
    senderTransferNumberInput.value = '';
});
</script>

</body>
              </html>
